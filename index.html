
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.6">
    
    
      
        <title>Full-Stack Machine Learning</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.875de78c.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exercises-of-each-day" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Full-Stack Machine Learning" class="md-header__button md-logo" aria-label="Full-Stack Machine Learning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Full-Stack Machine Learning
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introduction
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/polyrand/fs-week/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    polyrand/fs-week
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Full-Stack Machine Learning" class="md-nav__button md-logo" aria-label="Full-Stack Machine Learning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Full-Stack Machine Learning
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/polyrand/fs-week/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    polyrand/fs-week
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Introduction
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercises-of-each-day" class="md-nav__link">
    Exercises of each day
  </a>
  
    <nav class="md-nav" aria-label="Exercises of each day">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#day-1" class="md-nav__link">
    Day 1
  </a>
  
    <nav class="md-nav" aria-label="Day 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#day-12" class="md-nav__link">
    Day 1.2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#day-2" class="md-nav__link">
    Day 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#day-3" class="md-nav__link">
    Day 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#day-4" class="md-nav__link">
    Day 4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final" class="md-nav__link">
    Final
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="running/" class="md-nav__link">
        Running the apps
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="training/" class="md-nav__link">
        Training
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="dependecy_management.md" class="md-nav__link">
        Dependencies
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="models/" class="md-nav__link">
        Models
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercises-of-each-day" class="md-nav__link">
    Exercises of each day
  </a>
  
    <nav class="md-nav" aria-label="Exercises of each day">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#day-1" class="md-nav__link">
    Day 1
  </a>
  
    <nav class="md-nav" aria-label="Day 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#day-12" class="md-nav__link">
    Day 1.2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#day-2" class="md-nav__link">
    Day 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#day-3" class="md-nav__link">
    Day 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#day-4" class="md-nav__link">
    Day 4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final" class="md-nav__link">
    Final
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/polyrand/fs-week/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Introduction</h1>
                
                <p>This is a full-stack machine learning project. It includes the following:</p>
<ul>
<li>Multiple Flask apps</li>
<li>Model training script</li>
<li>Tests</li>
<li>GitHub workflow for automatic testing</li>
<li>A good project organization!</li>
<li>Documentation</li>
<li>Good dependency management. We are using <code>pip-tools</code> but other managers also work.</li>
<li>Automatic deployments to AWS SageMaker and saving the models to S3</li>
</ul>
<h2 id="exercises-of-each-day">Exercises of each day</h2>
<h3 id="day-1">Day 1</h3>
<p>Start a <strong>new</strong> and <strong>empty</strong> GitHub repository.</p>
<ol>
<li>Think about how you're going to organize your project. What folders will it have? What files will go into this folders?</li>
<li>
<p>Start writing <a href="/documentation">documentation</a> about your project. You will need to keep it updated throughout the week. The instructions provided are for MkDocs, but you can use other documentation methods if you want.</p>
</li>
<li>
<p>Write a script to train an ML model.</p>
</li>
</ol>
<p>Turn the 2.train.ipynb notebook into a python script</p>
<p>The script can have the following options:</p>
<pre><code>--download-data
--train --epochs INT (it should have a default)
--optimizer STRING
--load-weights STRING

# extra work:
# load the data URL from an environment variable (using a .env file and the python-dotenv package)
</code></pre>
<p>Then you can run the script like:</p>
<pre><code>python3 train.py --download-data --train --epochs 3 --optimizer sgd --load-weights my_weigths.pth
</code></pre>
<p><strong>Don't worry if you can't implement all the options</strong></p>
<h4 id="day-12">Day 1.2</h4>
<p>Try creating a Python class that abstracts all the operations you want to make that interact with the database.</p>
<pre><code class="language-python">class DB:

    def __init__(self, dbname):
        self.conn =  sqlite3.connect(dbname)

    def do_something(self):
        with self.conn as cursor:
            cursor.execute(&quot;.......&quot;, (a, b))
</code></pre>
<h3 id="day-2">Day 2</h3>
<ol>
<li>
<p>Understand <a href="https://github.com/polyrand/fs-week">this</a> github repository. 
why it's organized like that, how is the documentation written (using the <code>mkdocs</code> library we sa), and more importantly, understanding the <code>service.py</code> file. That file is a Flask application, last week you used flask to show some HTML, this week we are using it to receive an image and doing a prediction with it.</p>
</li>
<li>
<p>Create an HTML form using flask. An HTML form is the same thing you fill in when signing up in a new website. The task is creating an HTML form that lets the user upload an image. <a href="https://flask.palletsprojects.com/en/1.1.x/patterns/fileuploads/">Here's some info</a> on how to do it, but feel free to look for other resources.</p>
</li>
</ol>
<p>You can try doing everything inside <code>service.py</code> if that's easier at first. So both the file upload and model prediction is donde in the same place. Feel free to adapt the exercise.</p>
<ol>
<li>After that's done, try to integrate this HTML form with <code>service.py</code>, now when you receive an image, instead of doing nothing with it, use the requests library to send it to the other service.</li>
</ol>
<p>As always, having everything done is not the objective. The objective is that you understand how to design a solution to a problem and how to communicate and organize the "solution" (our project).</p>
<p>If you have time you can work on the documentation and improve it. Explain to other people how to run your service.py and/or app.py.</p>
<p><strong>Video</strong></p>
<p><a href="https://www.youtube.com/watch?v=4ZiZCqC6rRQ">Logging inside a Flask app</a></p>
<h3 id="day-3">Day 3</h3>
<ul>
<li>Create an HTML form to register a new user (email + password)</li>
<li>Save the password hashed to the DB</li>
<li>Finish writing the test in the <code>tests/test_app.py</code> file</li>
<li>Add some more tests, even if they are simple ones</li>
</ul>
<p>Extra:
* If you have problems with passlib. I will now create an alternative secure hashing function and update the file. It will take me 10 or 15 minutes.</p>
<p>Also, always take into account that hashing functions receive and return bytes, not strings. Passlib already handles that for you, but if you look at my implementation you'll see that I'm doing a few password.encode() to convert a string to bytes and hash(...).hex() to convert the hashed bytes to an hexadecimal string</p>
<p>if you are already receiving bytes you don't need to encode it, but when you get the data from the flask request i'm pretty sure it's as a string, not bytes. ANyway, if you don't get the hashing working 100% don't worry, you can "create" your own hashing by just appending a random string to the end. As long as you make it work and write a couple of tests.</p>
<p>Something extra to try in the exercises:</p>
<p>Creating a test for the ML model (taking the functions from service.py). For example, testing that the function returns one of the 2 classes. Or that if you have an image that it's been correctly predicted, write a test for it.</p>
<h3 id="day-4">Day 4</h3>
<p>Create a github workflow that does anything. It can be just a <code>print()</code> or running all the tests. You can do it in a new empty repository or in an old one.
Some resources that may be helpful:</p>
<ul>
<li>
<p><a href="https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions">Official introduction to GitHub Actions</a></p>
</li>
<li>
<p><a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions">GitHub Actios Syntax (this is a long one, you don't really need it for now)</a></p>
</li>
<li>
<p><a href="https://github.com/polyrand/fs-week/blob/main/.github/workflows/echo.yaml">A basic template for a github action. It does a print("hello") with Python</a></p>
</li>
</ul>
<p>Remember, the workflows/actions have to be inside a folder called <code>.github/workflows</code> inside your repo.</p>
<h3 id="final">Final</h3>
<p>So far we have learned how to deal with Flask apps <a href="/running">running</a> ML models, Python scripts to <a href="/training">train</a> models, how to organize a project or how to write <a href="/documentation">documentation</a>.</p>
<p>Now imagine your ML product has do more things. Your users may be sending you some unwanted data and you need to filter it. Well, the best way to do it is with another model. The task for the last day is:</p>
<ol>
<li>Getting a new dataset with items that are <strong>not</strong> part of your main dataset.</li>
<li>Train a yes/no model. The model should be able to filter data that does not belong to your dataset.</li>
<li>Deploy this model as a new Flask app.</li>
</ol>
<p>When a new item arrives, it first goes through the first Flask app / service. If it determines it belongs to your data, then send the item to the main Flask service.</p>
<p>Some things you may modify:</p>
<ul>
<li>
<p>Instead of running the image through the 2 flask apps, you can implement an HTML dropdown / form field to let the user choose which model they want to run the image through.</p>
</li>
<li>
<p>Instead of running the 2 ML models in different Flask apps, you can try putting the 2 models insider service.py. This is a double-edged sword. It's easier because you don't need to run an extra Flask app. However, now you need to load 2 models inside a single Flask app, which may also become a challenge.</p>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        <a href="documentation/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Documentation
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.34eae1b6.min.js"></script>
      
    
  </body>
</html>